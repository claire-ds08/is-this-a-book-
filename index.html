<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Memory Challenge</title>
    <style>
        :root { --paper: #f4ecd8; --accent: #d4a373; --text: #5d4037; }
        body { background: #2c241e; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; perspective: 2000px; font-family: 'Georgia', serif; overflow: hidden; touch-action: none; }
        .audio-player { position: absolute; top: 20px; z-index: 100; background: rgba(244, 236, 216, 0.9); padding: 5px 15px; border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.6); }
        .book { width: 380px; height: 500px; position: relative; transform-style: preserve-3d; }
        .page { width: 100%; height: 100%; position: absolute; background: var(--paper); border: 1px solid var(--accent); padding: 25px; box-sizing: border-box; display: flex; flex-direction: column; align-items: center; backface-visibility: hidden; transform-origin: left; transition: transform 1.2s cubic-bezier(0.645, 0.045, 0.355, 1); box-shadow: inset 3px 0 20px rgba(0,0,0,0.1); }
        .flipped { transform: rotateY(-180deg); }
        .grid-4pics { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 15px 0; }
        .grid-4pics img { width: 120px; height: 120px; object-fit: cover; border: 4px solid white; box-shadow: 2px 2px 5px rgba(0,0,0,0.2); }
        input { padding: 12px; border: 1px solid var(--accent); border-radius: 4px; text-align: center; width: 80%; font-size: 1rem; outline: none; }
        .btn { margin-top: 15px; padding: 10px 25px; background: var(--accent); color: white; border: none; cursor: pointer; border-radius: 4px; }
        #game-area { width: 100%; height: 200px; border-bottom: 3px solid var(--text); position: relative; overflow: hidden; background: linear-gradient(to bottom, #ff9a9e 0%, #fecfef 100%); margin: 10px 0; border-radius: 8px; }
        #heart-pop { position: absolute; bottom: 60px; left: 135px; font-size: 30px; display: none; animation: heartbeat 1s infinite; z-index: 10; }
        @keyframes heartbeat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.3); } }
        #scratch-container { position: relative; width: 300px; height: 150px; margin-top: 20px; cursor: crosshair; }
        #scratch-text { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; text-align: center; font-weight: bold; color: var(--text); font-size: 1.1rem; background: #fff; border: 2px dashed var(--accent); padding: 10px; box-sizing: border-box; }
        #scratch-canvas { position: absolute; top: 0; left: 0; z-index: 10; }
        .carnation { position: absolute; background-color: #ffa3b1; border-radius: 50% 0 50% 0; opacity: 0.8; pointer-events: none; z-index: 100; animation: fall linear infinite; }
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }
    </style>
</head>
<body>

<div class="audio-player">
    <audio id="bgMusic" controls loop>
        <source src="Keenan Te - Rest of My Life (Official Lyric Video).mp3" type="audio/mpeg">
    </audio>
    <audio id="successSound"><source src="Nickelodeon ApplauseClapping Sound Effects.mp3" type="audio/mpeg"></audio>
</div>

<div class="book">
    <div class="page" id="p1" style="z-index: 5;">
        <h2>Level 1: 4 Pics 1 Word</h2>
        <div class="grid-4pics">
            <img src="IMG_2452.jpeg"> <img src="IMG_2455.jpeg">
            <img src="IMG_2453.jpeg"> <img src="IMG_2456.jpeg">
        </div>
        <input type="text" id="ans1" placeholder="Enter word...">
        <button class="btn" onclick="checkLevel1()">Unlock Level 2</button>
    </div>

    <div class="page" id="p2" style="z-index: 4;">
        <h2>Level 2: Scramble</h2>
        <img src="IMG_2464.jpeg" style="width: 100%; height: 180px; object-fit: cover; border: 5px solid white; margin-bottom: 20px;">
        <div style="font-size: 1.5rem; letter-spacing: 5px; color: var(--accent); margin-bottom: 10px;">A L D I M A T</div>
        <input type="text" id="ans2" placeholder="Unscramble...">
        <button class="btn" onclick="checkLevel2()">Unlock Level 3</button>
    </div>

    <div class="page" id="p3" style="z-index: 3;">
        <h2>Level 3: The Quiz</h2>
        <div id="quiz-container">
            <p id="q-label" style="font-size: 0.8rem; color: var(--accent);">QUESTION 1 OF 3</p>
            <p id="q-text" style="font-weight:bold; min-height: 50px;">What movie did we first watch?</p>
            <input type="text" id="ansQuiz" placeholder="Answer here...">
            <button class="btn" onclick="checkQuiz()">Submit</button>
        </div>
    </div>

    <div class="page" id="p4" style="z-index: 2;">
        <h2>Level 4: Jump to Me!</h2>
        <div id="game-area">
            <div id="heart-pop">‚ù§Ô∏è</div>
            <img id="player" src="IMG_2465.jpeg" style="width:50px; position:absolute; bottom:0; left:20px; transition: left 1s, bottom 0.3s;">
            <img id="partner" src="IMG_2466.jpeg" style="width:50px; position:absolute; bottom:0; right:-60px; transition: right 1s;">
            <div id="thorn" style="width:25px; height:25px; background:#2e7d32; position:absolute; bottom:0; right:-30px; clip-path: polygon(50% 0%, 0% 100%, 100% 100%);"></div>
        </div>
        <p id="score">Score: 0</p>
        <div id="hug-reveal" style="display:none; text-align:center;">
            <p>Together at last! ü´Ç</p>
            <button class="btn" onclick="unlockFinal()">See Surprise</button>
        </div>
    </div>

    <div class="page" id="p5" style="z-index: 1;">
        <h2>Congratulations!</h2>
        <div id="scratch-container">
            <div id="scratch-text">You have won a date with me on Feb 13! ‚ù§Ô∏è</div>
            <canvas id="scratch-canvas" width="300" height="150"></canvas>
        </div>
        <button class="btn" onclick="location.reload()">Restart</button>
    </div>
</div>

<script>
    function flip(id) {
        document.getElementById(id).classList.add('flipped');
        setTimeout(() => { document.getElementById(id).style.zIndex = 0; }, 600);
    }

    function checkLevel1() {
        if(document.getElementById('ans1').value.toLowerCase().trim() === "love") {
            flip('p1');
        } else alert("Try again!");
    }

    function checkLevel2() {
        // Correcting spelling from "maldita" to "matilda" to match your scramble letters
        if(document.getElementById('ans2').value.toLowerCase().trim() === "matilda") {
            flip('p2');
        } else alert("Try again!");
    }

    let curQ = 1;
    function checkQuiz() {
        const val = document.getElementById('ansQuiz').value.toLowerCase().trim();
        const text = document.getElementById('q-text');
        const label = document.getElementById('q-label');
        const input = document.getElementById('ansQuiz');

        if(curQ === 1) {
            if(val === "quezon") {
                curQ = 2; label.innerText = "QUESTION 2 OF 3"; text.innerText = "Where was our first date?"; input.value = "";
            } else alert("Not quite! Try again.");
        } else if(curQ === 2) {
            if(val === "sm seaside") {
                curQ = 3; label.innerText = "QUESTION 3 OF 3"; text.innerText = "When was our first photo taken?"; input.value = "";
            } else alert("Wrong answer! Hint: PNA Convention.");
        } else if(curQ === 3) {
            if(val === "august 30") {
                flip('p3');
                setTimeout(initGame, 1000);
            } else alert("Last one! You can do it!");
        }
    }

    let score = 0, isPlaying = false;
    function initGame() {
        isPlaying = true;
        const thorn = document.getElementById('thorn');
        document.addEventListener('touchstart', (e) => {
            const p = document.getElementById('player');
            if(isPlaying && (p.style.bottom === "0px" || !p.style.bottom)) {
                p.style.bottom = "80px";
                setTimeout(() => p.style.bottom = "0", 300);
            }
        });

        let tPos = 300;
        let loop = setInterval(() => {
            if(!isPlaying) { clearInterval(loop); return; }
            tPos -= 6;
            if(tPos < -30) { tPos = 300; score++; document.getElementById('score').innerText = "Score: " + score; }
            if(score >= 10) { isPlaying = false; showHug(); }
            thorn.style.right = (300 - tPos) + "px";
            const pBottom = parseInt(document.getElementById('player').style.bottom) || 0;
            if(tPos > 210 && tPos < 250 && pBottom < 25) { score = 0; tPos = 300; document.getElementById('score').innerText = "Score: 0"; }
        }, 20);
    }

    function showHug() {
        document.getElementById('thorn').style.display = "none";
        document.getElementById('player').style.left = "110px";
        document.getElementById('partner').style.right = "110px";
        setTimeout(() => {
            document.getElementById('heart-pop').style.display = "block";
            document.getElementById('hug-reveal').style.display = "block";
            document.getElementById('successSound').play();
            setInterval(createCarnation, 400);
        }, 1000);
    }

    function unlockFinal() { flip('p4'); initScratch(); }

    function initScratch() {
        const canvas = document.getElementById('scratch-canvas');
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#C0C0C0'; ctx.fillRect(0,0,300,150);
        ctx.fillStyle = '#888'; ctx.font = '20px Georgia'; ctx.fillText('SCRATCH HERE', 75, 80);
        let draw = false;
        const scratch = (e) => {
            if(!draw) return;
            const r = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - r.left;
            const y = (e.clientY || e.touches[0].clientY) - r.top;
            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath(); ctx.arc(x,y,20,0,Math.PI*2); ctx.fill();
        };
        canvas.addEventListener('mousedown', () => draw = true);
        canvas.addEventListener('touchstart', (e) => { draw = true; e.preventDefault(); });
        window.addEventListener('mouseup', () => draw = false);
        window.addEventListener('touchend', () => draw = false);
        canvas.addEventListener('mousemove', scratch);
        canvas.addEventListener('touchmove', scratch);
    }

    function createCarnation() {
        const p = document.createElement('div'); p.className = 'carnation';
        p.style.left = Math.random() * 100 + 'vw'; p.style.width = p.style.height = '15px';
        p.style.animationDuration = (Math.random()*3+2)+'s';
        document.body.appendChild(p); setTimeout(() => p.remove(), 5000);
    }
</script>
</body>
</html>
